{% extends "open_base.html" %}
{% block titlecontainer %}
  <div class="w3-container">
{% endblock %}

{% block titleheader %}
  Verifikasjon {{ valgt_runde.klasse }} {{ valgt_runde.runde }}
{% endblock %}

{% block refresh %}{% endblock %}

{% block titlemain %}
  Verifikasjon {{ valgt_runde.klasse }} {{ valgt_runde.runde }}
{% endblock %}

{% block menuitems %}
  <li class=dropdown id=topborder>
    <a href=javascript:void(0) class=dropbtn>Velg runde</a>
    <div class=dropdown-content>
      {% for round in raceplan_summary %}
        <a href=timing_verify?event_id={{ event_id }}&klasse={{ round.name}}&runde=Q>{{ round.name}} kvart</a>
        <a href=timing_verify?event_id={{ event_id }}&klasse={{ round.name}}&runde=S>{{ round.name}} semi</a>
        <a href=timing_verify?event_id={{ event_id }}&klasse={{ round.name}}&runde=F>{{ round.name}} finaler</a>
      {% endfor %}
    </div>
  </li>
  {% if current_races %}
    <li id=topborder>
      <a class=dropbtn href=timing_verify?event_id={{ event_id }}&heat={{ (current_races|first).order - 1 }}>Forrige runde</a>
    </li>
  {% endif %}
  <li id=topborder>
    <a class=dropbtn href=timing_verify?event_id={{ event_id }}&heat=0>Starter n√•</a>
  </li>
  {% if current_races %}
    <li id=topborder>
      <a class=dropbtn href=timing_verify?event_id={{ event_id }}&heat={{ (current_races|last).order + 1 }}>Neste runde</a>
    </li>
  {% endif %}
{% endblock %}

{% block content %}
  <div id=spacer></div>
  <script>
    function green_bg(id) {
      document.getElementById(id).style.backgroundColor = "green";
    }
  </script>
  <table>
    <tr>
      <td>
        {% if error_passeringer|length > 0 %}
        <div id=info>Funnet {{ error_passeringer|length }} events med error, <a href="control?event_id={{ event_id }}&action=control">kontroller</a>.</div>
        {% endif %}
      </td>
      <td width=100>
        <form action=/print_lists method=get target=new>
          <input type="hidden" name=runde value="{{ valgt_runde.runde }}">
          <input type="hidden" name=action value=round_result>
          <input type="hidden" name=event_id value="{{ event_id }}">
          <input type="hidden" name=klasse value="{{ valgt_runde.klasse }}">
          <input type="submit" name="publish_results" value="  Skriv ut  ">
        </form>
      </td>
      <td width=100>
        <form action=/timing_verify method=post>
          <input type="hidden" name=runde value="{{ valgt_runde.runde }}">
          <input type="hidden" name=event_id value="{{ event_id }}">
          <input type="hidden" name=klasse value="{{ valgt_runde.klasse }}">
          <input type="submit" name="publish_results" value="  Publiser resultater  ">
        </form>
      </td>
    </tr>
  </table>
<div class="w3-row-padding">
    {% if valgt_runde.runde == "N" %}
      <div class="w3-third">
    {% else %}
      <div class="w3-twothird">
    {% endif %}
      <div id=adminpagetitle>
        {{ valgt_runde.klasse }}
        {% if valgt_runde.runde == "Q" %}Kvartfinaler
        {% elif valgt_runde.runde == "S" %}Semifinaler
        {% elif valgt_runde.runde == "F" %}Finaler
        {% endif %}
      </div>
      <table>
        {% for race in current_races %}
        <tr>
          <td colspan=10>&nbsp;</td>
        </tr>
          <tr>
            <td colspan=3><b>{{ race.raceclass }} {{ race.round }}{{ race.index }}{{ race.heat }}</b></td>
            <td colspan=6><b>{{ race.start_time[-8:] }}</b></td>
            <td>Heat {{ race.order }}</td>
          </tr>
          <tr id=headerblack>
            <td colspan=5>Startliste</td>
            <td colspan=5 id=resultheader>Resultat: {{ race.next_race }}</td>
          </tr>
          <tr>
            <td>Pos</td>
            <td width=40>Nr</td>
            <td>Navn</td>
            <td>Klubb</td>
            <td></td>
            <td id=resultborder>Plass</td>
            <td colspan=2 align=center>Startnr</td>
            <td>Navn</td>
            <td>Videre til</td>
          </tr>
          <form action=/timing_verify method=post>
            {% for start in race.startliste %}
              <tr>
                  <td>{{ start.starting_position }}</td>
                  <td id={{ start.bib }} align=center>{{ start.bib }}</td>
                  <td>{{ start.name }}</td>
                  <td>{{ start.club }}</td>
                  <td>{{ start.info }}</td>
                  <td id=resultborder align=center>{{ loop.index }}</td>
                  {% if race.finish_timings[loop.index0] %}
                    <td></td>
                    <td align=center>
                      <input type="number" name="form_rank_{{ loop.index }}" value="{% if race.finish_timings[loop.index0].bib > 0 %}{{ race.finish_timings[loop.index0].bib }}{% endif %}" min=1 max=9999 onchange="green_bg(this.value)">
                      <input type="hidden" name="old_form_rank_{{ loop.index }}" value="{% if race.finish_timings[loop.index0].bib > 0 %}{{ race.finish_timings[loop.index0].bib }}{% endif %}">
                      <input type="hidden" name="time_event_id_{{ loop.index }}" value="{{ race.finish_timings[loop.index0].id }}">
                    </td>
                    <td>{{ race.finish_timings[loop.index0].name }}</td>
                    <td>{{ race.finish_timings[loop.index0].next_race }}-{{ race.finish_timings[loop.index0].next_race_position }}</td>
                    <td>
                  {% else %}
                    <td></td>
                    <td align=center>
                      <input type="number" name="form_rank_{{ loop.index }}" value="" min=1 max=9999 onchange="green_bg(this.value)">
                      <input type="hidden" name="old_form_rank_{{ loop.index }}" value="" min=1 max=9999>
                    </td>
                    <td></td>
                    <td></td>
                  {% endif %}
              </tr>
            {% endfor %}
              <tr>
                <td colspan=7></td>
                <td colspan=3>
                  <input type="hidden" name="race" value="{{ race.raceclass }}-{{ race.round }}{{ race.heat }}{{ race.index }}">
                  <input type="hidden" name="race_id" value="{{ race.id }}">
                  <input type="hidden" name=runde value="{{ valgt_runde.runde }}">
                  <input type="hidden" name=klasse value="{{ valgt_runde.klasse }}">
                  <input type="hidden" name=event_id value="{{ event_id }}">
                  <input type="submit" name=update_result value="  Oppdater ">
                </td>
              </tr>
            </form>
            {% if race.startliste %}
              <tr>
                <form action=/timing_verify method=post>
                  <td><input type="number" name="starting_position" value="" min=1 max=99></td>
                  <td><input type="number" name="bib" value="" min=1 max=999></td>
                  <td colspan=3>
                      <input type="submit" name=create_start value=" Legg til ">
                      <input type="hidden" name="race_id" value="{{ race.id }}">
                      <input type="hidden" name="startlist_id" value="{{ race.startliste[0].startlist_id }}">
                      <input type="hidden" name="start_time" value="{{ race.start_time }}">
                      <input type="hidden" name=runde value="{{ valgt_runde.runde }}">
                      <input type="hidden" name=klasse value="{{ valgt_runde.klasse }}">
                      <input type="hidden" name=event_id value="{{ event_id }}">
                  </td>
                </form>
                <td colspan=5>&nbsp;</td>
              </tr>
            {% endif %}
          {% endfor %}
        </table>
      </div>
      <div class="w3-third">
        <div id=adminpagetitle>Neste runde</div>
        <table>
          {% for race in next_races %}
            <tr>
              <td colspan=5>&nbsp;</td>
            </tr>
            <tr>
              <td colspan=3><b>{{ race.raceclass }} {{ race.round }}{{ race.index }}{{ race.heat }}</b></td>
              <td colspan=2><b>{{ race.start_time[-8:] }}</b> (heat {{ race.order }})</td>
            </tr>
            <tr id=headerblue>
              <td colspan=5>Startliste</td>
            </tr>
            <tr>
              <td>Pos</td>
              <td colspan=2>Startnr</td>
              <td>Navn</td>
              <td>Klubb</td>
            </tr>
            {% for start in race.startliste %}
              <tr>
                <td align=center>{{ start.starting_position }}</td>
                <td align=center width=50>{{ start.bib }}</td>
                <td>
                  <form action=/timing_verify method=post>
                    <input type="submit" name=delete_start value=" Slett ">
                    <input type="hidden" name="race_id" value="{{ race.id }}">
                    <input type="hidden" name=start_id value="{{ start.id }}">
                    <input type="hidden" name=runde value="{{ valgt_runde.runde }}">
                    <input type="hidden" name=klasse value="{{ valgt_runde.klasse }}">
                    <input type="hidden" name=event_id value="{{ event_id }}">
                  </form>
                </td>
                <td>{{ start.name }}</td>
                <td>{{ start.club }}</td>
                <td></td>
                <td></td>
              </tr>
          {% endfor %}
          {% if race.startliste %}
          <tr>
            <form action=/timing_verify method=post>
              <td><input type="number" name="starting_position" value="" min=1 max=99></td>
              <td><input type="number" name="bib" value="" min=1 max=999></td>
              <td colspan=2>
                  <input type="submit" name=create_start value=" Legg til ">
                  <input type="hidden" name="race_id" value="{{ race.id }}">
                  <input type="hidden" name="startlist_id" value="{{ race.startliste[0].startlist_id }}">
                  <input type="hidden" name="start_time" value="{{ race.start_time }}">
                  <input type="hidden" name=runde value="{{ valgt_runde.runde }}">
                  <input type="hidden" name=klasse value="{{ valgt_runde.klasse }}">
                  <input type="hidden" name=event_id value="{{ event_id }}">
              </td>
            </form>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
          </tr>
          {% endif %}
        <tr id=spacer></tr>
      {% endfor %}
    </table>
  </div>
</div>
{% endblock %}
