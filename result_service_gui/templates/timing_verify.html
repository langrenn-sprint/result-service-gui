{% extends "adm_base.html" %}
{% block titlecontainer %}
  <div class="w3-10"></div>
  <div class="w3-80">
{% endblock %}

{% block titleheader %}
  Verifikasjon {{ action }} {{ valgt_runde }}
{% endblock %}

{% block refresh %}{% endblock %}

{% block titlemain %}
  Verifikasjon {{ action }} {{ valgt_runde }}
{% endblock %}

{% block menuitems %}
  <li class=dropdown id=topborder>
    <a href=javascript:void(0) class=dropbtn>Velg funksjon</a>
    <div class=dropdown-content>
        <a href=timing_verify?event_id={{ event_id }}&action=start&valgt_runde={{ valgt_runde }}>Endre startliste</a>
        <a href=timing_verify?event_id={{ event_id }}&action=result&valgt_runde={{ valgt_runde }}>Endre resultater</a>
        <a href="/dashboard?event_id={{ event_id }}">Oversikt</a>
    </div>
  </li>
  <li class=dropdown id=topborder>
    <a href=javascript:void(0) class=dropbtn>Velg runde</a>
    <div class=dropdown-content>
      {% for round in raceplan_summary %}
        <a href=timing_verify?event_id={{ event_id }}&action=result&valgt_runde={{ round.name}}Q>{{ round.name}} kvalifisering</a>
        <a href=timing_verify?event_id={{ event_id }}&action=result&valgt_runde={{ round.name}}S>{{ round.name}} semi</a>
        <a href=timing_verify?event_id={{ event_id }}&action=result&valgt_runde={{ round.name}}F>{{ round.name}} finaler</a>
      {% endfor %}
    </div>
  </li>
{% endblock %}

{% block content %}
  <div id=spacer></div>
    <table>
      {% if action == "result" %}
      <form action=/timing_verify method=post>
        <tr>
            <td colspan=6></td>
            <td colspan=2>
              <input type="hidden" name=valgt_runde value="{{ valgt_runde }}">
              <input type="hidden" name=event_id value="{{ event_id }}">
              <input type="hidden" name=action value="{{ action }}">
              <input type="submit" name="publish_results" value="  Publiser resultater  ">
            </td>
            <td colspan=2></td>
        </tr>
      </form>
      {% endif %}
      <tr id=spacer>
      </tr>
      {% for race in races %}
        <tr id=headerblue>
          <td>Pos</td>
          <td width=50>Startnr</td>
          <td></td>
          <td colspan=2><b>{{ race.raceclass }}{{ race.round }}{{ race.index }}{{ race.heat }}  kl:{{ race.start_time }} (Heat {{ race.order }})</b></td>
          <td>Videre til: {{ race.next_race }}</td>
          <td>Plass</td>
          <td colspan=2>Startnr</td>
        </tr>
        {% for start in race.startliste %}
          {% if action == "result" %}
            <tr>
              <form action=/timing_verify method=post>
                <td>{{ start.starting_position }}</td>
                <td align=center>{{ start.bib }}</td>
                <td></td>
                <td>{{ start.name }}</td>
                <td>{{ start.club }}</td>
                <td>{{ start.info }}</td>
                <td>{{ start.starting_position }}</td>
                {% if start.finish_bib %}
                  <td>{{ start.finish_bib }}</td>
                  <td>
                    <input type="submit" name=delete_result value="  Slett resultat ">
                    <input type="hidden" name="bib" value="{{ start.finish_bib }}">
                    <input type="hidden" name="time_event_id" value="{{ start.finish_event_id }}">
                    <input type="hidden" name=valgt_runde value="{{ valgt_runde }}">
                    <input type="hidden" name=action value="{{ action }}">
                    <input type="hidden" name=event_id value="{{ event_id }}">
                  </td>
                {% else %}
                  <td>
                    <input type="number" name="form_rank_{{ start.starting_position }}" value="{{ start.finish_bib }}" min=1 max=9999>
                  </td>
                  <td>
                    <input type="hidden" name="race" value="{{ race.raceclass }}-{{ race.round }}{{ race.heat }}{{ race.index }}">
                    <input type="hidden" name="race_id" value="{{ race.id }}">
                    <input type="hidden" name=valgt_runde value="{{ valgt_runde }}">
                    <input type="hidden" name=action value="{{ action }}">
                    <input type="hidden" name=event_id value="{{ event_id }}">
                    <input type="submit" name=update_result value="  Oppdater ">
                  </td>
                {% endif %}
              </form>
            </tr>
          {% elif action == "start" %}
            <tr>
              <td>{{ start.starting_position }}</td>
              <td align=center>{{ start.bib }}</td>
              <td>
                <form action=/timing_verify method=post>
                  <input type="submit" name=delete_start value="  Slett start ">
                  <input type="hidden" name="race_id" value="{{ race.id }}">
                  <input type="hidden" name=start_id value="{{ start.id }}">
                  <input type="hidden" name=valgt_runde value="{{ valgt_runde }}">
                  <input type="hidden" name=action value="{{ action }}">
                  <input type="hidden" name=event_id value="{{ event_id }}">
                </form>
              </td>
              <td>{{ start.name }}</td>
              <td>{{ start.club }}</td>
              <td>{{ start.info }}</td>
              <td>{{ start.starting_position }}</td>
              <td>{{ start.finish_bib }}</td>
              <td></td>
              <td></td>
            </tr>
          {% endif %}
        {% endfor %}
        {% if action == "start" %}
          <tr>
            <form action=/timing_verify method=post>
              <td><input type="number" name="starting_position" value="" min=1 max=99></td>
              <td align=center><input type="number" name="bib" value="" min=1 max=9999></td>
              <td>
                  <input type="submit" name=create_start value="  Legg til start ">
                  <input type="hidden" name="race_id" value="{{ race.id }}">
                  <input type="hidden" name="startlist_id" value="{{ race.startliste[0].startlist_id }}">
                  <input type="hidden" name="start_time" value="{{ race.start_time }}">
                  <input type="hidden" name=valgt_runde value="{{ valgt_runde }}">
                  <input type="hidden" name=action value="{{ action }}">
                  <input type="hidden" name=event_id value="{{ event_id }}">
              </td>
            </form>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
          </tr>
        {% endif %}
      <tr id=spacer>
      </tr>
      {% endfor %}
    </table>
{% endblock %}
