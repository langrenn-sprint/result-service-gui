{% extends "open_base.html" %}
{% block titlecontainer %}
  <div class="w3-10"></div>
  <div class="w3-80">
{% endblock %}

{% block titleheader %}Foto redigering{% endblock %}

{% block headercontainer %}Foto redigering {{ valgt_klasse }} <img id=header_icon src="../static/icon_photos.png"> {% endblock %}

{% block refresh %}{% endblock %}
{% block titlemain %}
  <img id=menu_icon src="../static/icon_photos.png"> Foto redigering
{% endblock %}
{% block menuitems %}
  <li class=dropdown id=topborder>
    <a href=javascript:void(0) class=dropbtn>Velg Google album</a>
    <div class=dropdown-content>
      {% for one_album in all_albums.albums %}
          <a href=photo_edit?event_id={{ event_id }}&album_id={{ one_album.id }}&album_title={{ one_album.title.replace(" ", "%20") }}><img width=30 src={{ one_album.coverPhotoBaseUrl }}> {{ one_album.title }}</a>
      {% endfor %}
    </div>
  </li>
{% endblock %}

{% block content %}
<! --- Edit menu --->
  <script>
    function checkform(form) {
      try {
        form.sync_from_google.value = 'Nye bilder analyseres, vennligst vent...';
        return true
      }
      catch(err) {
        return true
      }
    }
  </script>
  <table>
    <tr id=headerblue align=right>
      <td>
        <form action=/photo_edit method=post onsubmit="return checkform(this);">
          <input type="hidden" name="event_id" value="{{ event_id }}">
          <input type="hidden" name="album_id" value="{{ album_id }}">
          <input type="hidden" name="album_title" value="{{ lopsinfo }}">
          <input type="submit" name="sync_from_google" value="  Synkroniser med google album - {{ lopsinfo }} ">
        </form>
      </td>
      <td>
        <form action=/photo_edit method=get>
          <input type="hidden" name=event_id value="{{ event_id }}">
          <input type="hidden" name="album_id" value="{{ album_id }}">
          <input type="hidden" name="album_title" value="{{ lopsinfo }}">
          <input type="hidden" name=action value="update_race_info">
          <input type="submit" name=update_race_info value="  Rediger lÃ¸psinformasjon  ">
        </form>
      </td>
      <td>
        <form action=/photo_edit method=get>
          <input type="hidden" name=event_id value="{{ event_id }}">
          <input type="hidden" name="album_id" value="{{ album_id }}">
          <input type="hidden" name="album_title" value="{{ lopsinfo }}">
          <input type="hidden" name=action value="star_photo">
          <input type="submit" name=star_photo value="  Sett stjernemerke  ">
        </form>
      </td>
      <td>
        <form action=/photo_edit method=get>
          <input type="hidden" name=event_id value="{{ event_id }}">
          <input type="hidden" name="album_id" value="{{ album_id }}">
          <input type="hidden" name="album_title" value="{{ lopsinfo }}">
          <input type="hidden" name=action value="delete_select">
          <input type="submit" name=delete_select value="  Slett lokale kopier  ">
        </form>
      </td>
      <td>
        <form action=/photo_edit method=post>
          <input type="hidden" name="event_id" value="{{ event_id }}">
          <input type="hidden" name="album_id" value="{{ album_id }}">
          <input type="hidden" name="album_title" value="{{ lopsinfo }}">
          <input type="submit" name="delete_all_local" value="  Slett alle lokale kopier  ">
        </form>
      </td>
  </table>
  <div id=spacer></div>
  <table>
    <tr><td valign=top>
      {% if action == "" %}
        <table cellpadding=4>
          <tr>
            <td colspan=4 id=headerblue>
              <b>Bilder fra Google Album: {{ lopsinfo }}</b>
            </td>
          </tr>
          {% for foto in album.mediaItems %}
            <tr>
              <td width=220>
                <a class="tooltip" href="">
                  <img width=200 src={{ foto.baseUrl }}=w200-h100-c>
                   <span>
                       <img id=tooltipimage src="{{ foto.baseUrl }}=w800-h800">
                   </span>
                </a>
              </td>
              <td>
                Tid: {{ foto.mediaMetadata.creationTime }}<br>
                {{ foto.mediaMetadata.photo.cameraModel }}<br>
                Filnavn: {{ foto.filename }}
              </td>
              <td><a target=_blank href={{ foto.productUrl }}>Bilde i Google</a></td>
            </tr>
          {% endfor %}
        </table>
      {% endif %}
      </td><td valign=top>
        <table cellpadding=4>
          <tr>
            <td colspan=4 id=headerblue>
              <b>Bilder - lokale kopier</b>
            </td>
          </tr>
          {% if action in ["delete_select", "star_photo", "update_race_info"] %}
          <tr>
            <td colspan=4>
            <form action=/photo_edit method=post>
              <input type="submit" name={{ action }} value="  Oppdater  ">
              <input type="hidden" name="event_id" value="{{ event_id }}">
              <input type="hidden" name="album_id" value="{{ album_id }}">
              <input type="hidden" name="album_title" value="{{ lopsinfo }}">
              <input type="hidden" name=action value={{ action }}>
            </td>
          </tr>
          {% endif %}

          {% for foto in photos %}
            <tr>
              {% if action in ["delete_select", "star_photo"] %}
                <td>
                  <input type="checkbox" name="update_{{ foto.id }}" value="{{ foto.id }}">
                </td>
              {% endif %}
              <td width=220>
                {{ foto.starred }}<br>
                <a class="tooltip">
                  <img width=200 src={{ foto.g_base_url }}=w200-h100-c>
                   <span>
                       <img id=tooltipimage src="{{ foto.g_base_url }}=w800-h800">
                   </span>
                </a><br>
                <a target=_blank href={{ foto.g_product_url }}>Bilde i Google</a>
              </td>
              <td>
                <table>
                  <tr><td>Info</td><td>{{ foto.creation_time }} / {{ foto.name }}</td></tr>
                  <tr><td>AI info</td><td>{{ foto.ai_information }}</td></tr>
                  <tr><td>Klasse</td><td>{{ foto.raceclass }}, race_id: {{ foto.race_id }}</td></tr>
                  <tr><td>Bibs</td><td>
                    {% if action == "update_race_info" %}
                      <input name="biblist_{{ foto.id }}" value="{{ foto.biblist }}">
                      <input type="hidden" name="old_biblist_{{ foto.id }}" value="{{ foto.biblist }}">
                    {% else %}
                      {{ foto.biblist }}
                    {% endif %}
                  </td></tr>
                  <tr><td>Clubs</td><td>{{ foto.clublist }}</td></tr>
                </table>
              </td>
            </tr>
          {% endfor %}
          {% if action in ["delete_select", "star_photo", "update_race_info"] %}
          <tr>
            <td colspan=4>
              <input type="submit" name={{ action }} value="  Oppdater  ">
              </form>
            </td>
          </tr>
          {% endif %}
        </table>
      </td></tr>
    </table>
{% endblock %}
