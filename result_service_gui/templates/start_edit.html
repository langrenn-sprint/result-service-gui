{% extends "open_base.html" %}
{% block titlecontainer %}
  <div class="w3-10"></div>
  <div class="w3-80">
{% endblock %}

{% block titleheader %}
  Rediger {{ action }} {{ valgt_klasse }}
{% endblock %}

{% block headercontainer %}Rediger startlister {{ valgt_klasse }} <img id=header_icon src="../static/icon_start.png"> {% endblock %}

{% block refresh %}{% endblock %}

{% block titlemain %}
  <img id=menu_icon src="../static/icon_start.png"> Rediger {{ action }} {{ valgt_klasse }}
{% endblock %}

{% block menuitems %}
  <li class=dropdown id=topborder>
    <a href=javascript:void(0) class=dropbtn>Velg klasse</a>
    <div class=dropdown-content>
      {% for raceclass in raceclasses %}
        <a href=start_edit?event_id={{ event_id }}&klasse={{ raceclass.name }}&action={{ action }}>{{ raceclass.name }}</a>
      {% endfor %}
    </div>
  </li>
{% endblock %}

{% block content %}
    <table>
      {% for race in next_races %}
        <tr>
          <td colspan=5>&nbsp;</td>
        </tr>
        <tr>
          <td colspan=3><b>{{ race.raceclass }} {{ race.round }}{{ race.index }}{{ race.heat }}</b></td>
          <td colspan=2><b>{{ race.start_time[-8:] }}</b> (heat {{ race.order }})</td>
        </tr>
        {% if action == "Template" %}
        <form action=/start_edit method=post>
          <tr id=headerblue>
            <td>Plass</td>
            <td colspan=2>Videre til</td>
            <td colspan=2>Ny verdi</td>
          </tr>
          {% for template in templates %}
            {% if template.race_id == race.id %}
            <tr>
              <td align=center>{{ template.rank }}</td>
              <td>{{ template.next_race }}&nbsp;-&nbsp;{{ template.next_race_position }}</td>
              <td colspan=2>
                <input type=text name="next_race_{{ template.rank }}" value="" size=4>&nbsp;-&nbsp;
                <input type=number name="next_race_position_{{ template.rank }}" value="" max=99 min=0>
                <input type="hidden" name="id_{{ template.rank }}" value="{{ template.id }}">
              </td>
              <td></td>
            </tr>
            {% endif %}
          {% endfor %}
            <tr>
              <td align=right><input type=number name="rank_new" value="" max=99 min=0></td>
              <td></td>
              <td colspan=2>
                <input type=text name="next_race_new" value="" size=4>&nbsp;-&nbsp;
                <input type=number name="next_race_position_new" value="" max=99 min=0>
              </td>
              <td>Opprett ny template event</td>
          </tr>
            <tr>
              <td colspan=5>
                <input type="hidden" name="action" value="{{ action }}">
                <input type="hidden" name="event_id" value="{{ event_id }}">
                <input type="hidden" name="race" value="{{ race.raceclass }}-{{ race.round }}{{ race.index }}{{ race.heat }}">
                <input type="hidden" name="race_id" value="{{ race.id }}">
                <input type="hidden" name="timing_point" value="{{ action }}">
                <input type="hidden" name="klasse" value="{{ valgt_klasse }}">
                <input type="submit" name="update_templates" value="  Lagre  ">
              </td>
            </tr>
          </form>
        {% else %}
          <tr id=headerblue>
            <td>Pos</td>
            <td colspan=2>Startnr</td>
            <td>Navn</td>
            <td>Klubb</td>
          </tr>
          {% for start in race.startliste %}
            <tr>
              <td align=center>{{ start.starting_position }}</td>
              <td align=center width=50>{{ start.bib }}</td>
              <td>
                <form action=/start_edit method=post>
                  <input type="submit" name=delete_start value=" Slett ">
                  <input type="hidden" name="race_id" value="{{ race.id }}">
                  <input type="hidden" name=start_id value="{{ start.id }}">
                  <input type="hidden" name=klasse value="{{ valgt_klasse }}">
                  <input type="hidden" name=event_id value="{{ event_id }}">
                </form>
              </td>
              <td>{{ start.name }}</td>
              <td>{{ start.club }}</td>
              <td></td>
              <td></td>
            </tr>
          {% endfor %}
          {% if race.startliste %}
          <tr>
            <form action=/start_edit method=post>
              <td><input type="number" name="starting_position" value="" min=1 max=99></td>
              <td><input type="number" name="bib" value="" min=1 max=999></td>
              <td colspan=2>
                  <input type="submit" name=create_start value=" Legg til ">
                  <input type="hidden" name="race_id" value="{{ race.id }}">
                  <input type="hidden" name="startlist_id" value="{{ race.startliste[0].startlist_id }}">
                  <input type="hidden" name="start_time" value="{{ race.start_time }}">
                  <input type="hidden" name=klasse value="{{ valgt_klasse }}">
                  <input type="hidden" name=event_id value="{{ event_id }}">
              </td>
            </form>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
          </tr>
          {% endif %}
        {% endif %}
        <tr id=spacer></tr>
      {% endfor %}
    </table>
{% endblock %}
